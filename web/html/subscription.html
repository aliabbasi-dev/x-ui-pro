{{ template "page/head_start" .}}
<script src="{{ .base_path }}assets/moment/moment.min.js"></script>
<script src="{{ .base_path }}assets/moment/moment-jalali.min.js?{{ .cur_ver }}"></script>
<script src="{{ .base_path }}assets/vue/vue.min.js?{{ .cur_ver }}"></script>
<script src="{{ .base_path }}assets/ant-design-vue/antd.min.js"></script>
<script src="{{ .base_path }}assets/js/util/index.js?{{ .cur_ver }}"></script>
<script src="{{ .base_path }}assets/js/util/date-util.js?{{ .cur_ver }}"></script>
<script src="{{ .base_path }}assets/qrcode/qrious2.min.js?{{ .cur_ver }}"></script>

<style>
/* Reset and Global Styles */
body, html, #app {
    margin: 0;
    padding: 0;
    height: 100%;
    font-family: 'Poppins', sans-serif;
    color: #fff;
    overflow-x: hidden;
    background: #121212; /* A deep, dark background */
}

/* New Modern Card */
.modern-card {
    background: #1e1e1e !important;
    border: none !important;
    border-radius: 20px !important;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4) !important;
    transition: all 0.3s ease;
    overflow: hidden;
}

/* Card Header */
.ant-card-head {
    border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
}
.ant-card-head-title, .ant-card-extra {
    color: #fff !important;
    font-weight: 600;
}

/* Card Body */
.ant-card-body {
    background: transparent !important;
    padding: 24px;
}

/* Section Headings */
.section-title {
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 20px;
    color: #00e0ff;
    border-bottom: 2px solid rgba(0, 224, 255, 0.2);
    padding-bottom: 5px;
}

/* QR Code Section */
.qr-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 30px;
    margin-bottom: 30px;
}
.qr-container {
    background: #2b2b2b;
    padding: 15px;
    border-radius: 15px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.3);
    text-align: center;
    position: relative;
}
.qr-title {
    color: #888;
    font-size: 0.9rem;
    font-weight: 500;
    margin-bottom: 10px;
}
.qr-cv {
    display: block;
    border-radius: 10px;
    cursor: pointer;
    transition: transform 0.3s;
}
.qr-cv:hover {
    transform: scale(1.05);
}

/* Info Grid */
.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
}
.info-item {
    background: #2b2b2b;
    border-radius: 10px;
    padding: 15px;
    display: flex;
    align-items: center;
    gap: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    transition: transform 0.2s, box-shadow 0.2s;
}
.info-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.3);
}
.info-icon {
    font-size: 24px;
    color: #00e0ff;
}
.info-text {
    flex-grow: 1;
}
.info-label {
    font-size: 0.8rem;
    color: #999;
    margin-bottom: 4px;
}
.info-value {
    font-size: 1.1rem;
    font-weight: 600;
}

/* Gradient Buttons */
.gradient-button {
    background: linear-gradient(90deg, #00e0ff, #ff00ff) !important;
    border: none !important;
    color: #1a1a2e !important;
    font-weight: 600 !important;
    border-radius: 10px !important;
    box-shadow: 0 4px 15px rgba(0, 224, 255, 0.2), 0 4px 15px rgba(255, 0, 255, 0.2);
    transition: all 0.3s ease;
}
.gradient-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 224, 255, 0.4), 0 6px 20px rgba(255, 0, 255, 0.4);
}

/* Dropdown Menu */
.ant-dropdown-menu {
    background: #2b2b2b !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    border-radius: 10px;
}
.ant-dropdown-menu-item {
    color: #fff !important;
    transition: background-color 0.2s;
}
.ant-dropdown-menu-item:hover {
    background-color: rgba(255, 255, 255, 0.05) !important;
    color: #00e0ff !important;
}

/* General Layout Adjustments */
.flex-center {
    display: flex;
    justify-content: center;
    align-items: center;
}
.mt-5 {
    margin-top: 3rem;
}

</style>
{{ template "page/head_end" .}}

{{ template "page/body_start" .}}
<a-layout id="app" v-cloak :class="themeSwitcher.currentTheme">
    <a-layout-content class="p-2">
        <a-row type="flex" justify="center" class="mt-5">
            <a-col :xs="24" :sm="22" :md="18" :lg="14" :xl="12">
                <a-card class="modern-card">
                    <template #title>
                        <a-space>
                            <span>{{ i18n "subscription.title" }}</span>
                            <a-tag>{{ .sId }}</a-tag>
                        </a-space>
                    </template>
                    <template #extra>
                        <a-popover
                            :overlay-class-name="themeSwitcher.currentTheme"
                            title='{{ i18n "menu.settings" }}'
                            placement="bottomRight" trigger="click">
                            <template #content>
                                <a-space direction="vertical" :size="10">
                                    <a-theme-switch-login></a-theme-switch-login>
                                    <span>{{ i18n "pages.settings.language" }}</span>
                                    <a-select ref="selectLang" class="w-100"
                                              v-model="lang"
                                              @change="LanguageManager.setLanguage(lang)"
                                              :dropdown-class-name="themeSwitcher.currentTheme">
                                        <a-select-option :value="l.value"
                                                         label="English"
                                                         v-for="l in LanguageManager.supportedLanguages"
                                                         :key="l.value">
                                            <span role="img" :aria-label="l.name" v-text="l.icon"></span>
                                            &nbsp;&nbsp;<span v-text="l.name"></span>
                                        </a-select-option>
                                    </a-select>
                                </a-space>
                            </template>
                            <a-button shape="circle" icon="setting"></a-button>
                        </a-popover>
                    </template>

                    <a-form layout="vertical">
                        <h2 class="section-title">QR Codes</h2>
                        <a-row :gutter="[24, 24]" type="flex" justify="center">
                            <a-col :xs="24" :sm="12">
                                <div class="qr-container flex-center">
                                    <h4 class="qr-title">{{ i18n "pages.settings.subSettings"}}</h4>
                                    <canvas id="qrcode" class="qr-cv" title='{{ i18n "copy" }}' @click="copy(app.subUrl)"></canvas>
                                </div>
                            </a-col>
                            <a-col :xs="24" :sm="12">
                                <div class="qr-container flex-center">
                                    <h4 class="qr-title">{{ i18n "pages.settings.subSettings"}} Json</h4>
                                    <canvas id="qrcode-subjson" class="qr-cv" title='{{ i18n "copy" }}' @click="copy(app.subJsonUrl)"></canvas>
                                </div>
                            </a-col>
                        </a-row>

                        <h2 class="section-title" style="margin-top: 30px;">Subscription Info</h2>
                        <div class="info-grid">
                            <div class="info-item">
                                <a-icon type="idcard" class="info-icon" />
                                <div class="info-text">
                                    <div class="info-label">{{ i18n "subscription.subId" }}</div>
                                    <div class="info-value">[[ app.sId ]]</div>
                                </div>
                            </div>
                            <div class="info-item">
                                <a-icon type="check-circle" class="info-icon" />
                                <div class="info-text">
                                    <div class="info-label">{{ i18n "subscription.status" }}</div>
                                    <div class="info-value">
                                        <template v-if="isUnlimited">
                                            <a-tag color="cyan">{{ i18n "subscription.unlimited" }}</a-tag>
                                        </template>
                                        <template v-else>
                                            <a-tag :color="isActive ? 'green' : 'red'">[[ isActive ? '{{ i18n "subscription.active" }}' : '{{ i18n "subscription.inactive" }}' ]]</a-tag>
                                        </template>
                                    </div>
                                </div>
                            </div>
                            <div class="info-item">
                                <a-icon type="arrow-down" class="info-icon" />
                                <div class="info-text">
                                    <div class="info-label">{{ i18n "subscription.downloaded" }}</div>
                                    <div class="info-value">[[ app.download ]]</div>
                                </div>
                            </div>
                            <div class="info-item">
                                <a-icon type="arrow-up" class="info-icon" />
                                <div class="info-text">
                                    <div class="info-label">{{ i18n "subscription.uploaded" }}</div>
                                    <div class="info-value">[[ app.upload ]]</div>
                                </div>
                            </div>
                            <div class="info-item">
                                <a-icon type="pie-chart" class="info-icon" />
                                <div class="info-text">
                                    <div class="info-label">{{ i18n "usage" }}</div>
                                    <div class="info-value">[[ app.used ]]</div>
                                </div>
                            </div>
                            <div class="info-item">
                                <a-icon type="database" class="info-icon" />
                                <div class="info-text">
                                    <div class="info-label">{{ i18n "subscription.totalQuota" }}</div>
                                    <div class="info-value">[[ app.total ]]</div>
                                </div>
                            </div>
                            <div class="info-item" v-if="app.totalByte > 0">
                                <a-icon type="hourglass" class="info-icon" />
                                <div class="info-text">
                                    <div class="info-label">{{ i18n "remained" }}</div>
                                    <div class="info-value">[[ app.remained ]]</div>
                                </div>
                            </div>
                            <div class="info-item">
                                <a-icon type="history" class="info-icon" />
                                <div class="info-text">
                                    <div class="info-label">{{ i18n "lastOnline" }}</div>
                                    <div class="info-value">
                                        <template v-if="app.lastOnlineMs > 0">
                                            <template v-if="app.datepicker === 'gregorian'">
                                                [[ DateUtil.formatMillis(app.lastOnlineMs) ]]
                                            </template>
                                            <template v-else>
                                                [[ DateUtil.convertToJalalian(moment(app.lastOnlineMs)) ]]
                                            </template>
                                        </template>
                                        <template v-else>
                                            <span>-</span>
                                        </template>
                                    </div>
                                </div>
                            </div>
                            <div class="info-item">
                                <a-icon type="calendar" class="info-icon" />
                                <div class="info-text">
                                    <div class="info-label">{{ i18n "subscription.expiry" }}</div>
                                    <div class="info-value">
                                        <template v-if="app.expireMs === 0">
                                            {{ i18n "subscription.noExpiry" }}
                                        </template>
                                        <template v-else>
                                            <template v-if="app.datepicker === 'gregorian'">
                                                [[ DateUtil.formatMillis(app.expireMs) ]]
                                            </template>
                                            <template v-else>
                                                [[ DateUtil.convertToJalalian(moment(app.expireMs)) ]]
                                            </template>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <h2 class="section-title" style="margin-top: 30px;">One-click Links</h2>
                        <a-row type="flex" justify="center" :gutter="[16,16]">
                            <a-col :xs="24" :sm="12">
                                <a-dropdown :trigger="['click']">
                                    <a-button :block="isMobile" class="gradient-button" size="large">
                                        Android <a-icon type="down" />
                                    </a-button>
                                    <a-menu slot="overlay" :class="themeSwitcher.currentTheme">
                                        <a-menu-item key="android-v2box" @click="open('v2box://install-sub?url=' + encodeURIComponent(app.subUrl) + '&name=' + encodeURIComponent(app.sId))">V2Box</a-menu-item>
                                        <a-menu-item key="android-v2rayng" @click="open('v2rayng://install-config?url=' + encodeURIComponent(app.subUrl))">V2RayNG</a-menu-item>
                                        <a-menu-item key="android-singbox" @click="copy(app.subUrl)">Sing-box</a-menu-item>
                                        <a-menu-item key="android-v2raytun" @click="copy(app.subUrl)">V2RayTun</a-menu-item>
                                        <a-menu-item key="android-npvtunnel" @click="copy(app.subUrl)">NPV Tunnel</a-menu-item>
                                    </a-menu>
                                </a-dropdown>
                            </a-col>
                            <a-col :xs="24" :sm="12">
                                <a-dropdown :trigger="['click']">
                                    <a-button :block="isMobile" class="gradient-button" size="large">
                                        iOS <a-icon type="down" />
                                    </a-button>
                                    <a-menu slot="overlay" :class="themeSwitcher.currentTheme">
                                        <a-menu-item key="ios-shadowrocket" @click="open('shadowrocket://add/subscription?url=' + encodeURIComponent(app.subUrl) + '&remark=' + encodeURIComponent(app.sId))">Shadowrocket</a-menu-item>
                                        <a-menu-item key="ios-v2box" @click="open('v2box://install-sub?url=' + encodeURIComponent(app.subUrl) + '&name=' + encodeURIComponent(app.sId))">V2Box</a-menu-item>
                                        <a-menu-item key="ios-streisand" @click="open('streisand://import/' + encodeURIComponent(app.subUrl))">Streisand</a-menu-item>
                                        <a-menu-item key="ios-v2raytun" @click="copy(app.subUrl)">V2RayTun</a-menu-item>
                                        <a-menu-item key="ios-npvtunnel" @click="copy(app.subUrl)">NPV Tunnel</a-menu-item>
                                    </a-menu>
                                </a-dropdown>
                            </a-col>
                        </a-row>
                    </a-form>
                </a-card>
            </a-col>
        </a-row>
    </a-layout-content>
</a-layout>

<template id="subscription-data" data-sid="{{ .sId }}"
    data-sub-url="{{ .subUrl }}" data-subjson-url="{{ .subJsonUrl }}"
    data-download="{{ .download }}"
    data-upload="{{ .upload }}" data-used="{{ .used }}"
    data-total="{{ .total }}" data-remained="{{ .remained }}"
    data-expire="{{ .expire }}" data-lastonline="{{ .lastOnline }}"
    data-downloadbyte="{{ .downloadByte }}"
    data-uploadbyte="{{ .uploadByte }}" data-totalbyte="{{ .totalByte }}"
    data-datepicker="{{ .datepicker }}"></template>
<textarea id="subscription-links"
    style="display:none">{{ range .result }}{{ . }}
{{ end }}</textarea>

{{template "component/aThemeSwitch" .}}
<script src="{{ .base_path }}assets/js/subscription.js?{{ .cur_ver }}"></script>

{{ template "page/body_end" .}}