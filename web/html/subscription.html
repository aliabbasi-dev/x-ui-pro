{{ template "page/head_start" .}}
<script src="{{ .base_path }}assets/moment/moment.min.js"></script>
<script src="{{ .base_path }}assets/moment/moment-jalali.min.js?{{ .cur_ver }}"></script>
<script src="{{ .base_path }}assets/vue/vue.min.js?{{ .cur_ver }}"></script>
<script src="{{ .base_path }}assets/ant-design-vue/antd.min.js"></script>
<script src="{{ .base_path }}assets/js/util/index.js?{{ .cur_ver }}"></script>
<script src="{{ .base_path }}assets/js/util/date-util.js?{{ .cur_ver }}"></script>
<script src="{{ .base_path }}assets/qrcode/qrious2.min.js?{{ .cur_ver }}"></script>

<style>
/* ====== Reset & Global Styles ====== */
body, html, #app {
    margin: 0;
    padding: 0;
    height: 100%;
    font-family: 'Poppins', sans-serif;
    color: #fff;
    overflow-x: hidden;
}

/* ====== Animated Background (New) ====== */
body {
    background: #1a1a2e;
    overflow: hidden;
}

.background-animated {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at 20% 20%, rgba(0,255,255,0.1), transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255,0,255,0.1), transparent 50%);
    background-size: 200% 200%;
    animation: moveBG 20s linear infinite alternate;
    z-index: -1;
}

@keyframes moveBG {
    0% { background-position: 0% 0%, 100% 100%; }
    100% { background-position: 100% 0%, 0% 100%; }
}

/* ====== Card Styles (Glassmorphism) ====== */
.subscription-card {
    background: rgba(255, 255, 255, 0.05) !important;
    backdrop-filter: blur(15px) saturate(180%);
    -webkit-backdrop-filter: blur(15px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
    border-radius: 20px !important;
    box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3) !important;
    transition: all 0.3s ease;
}

.subscription-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 60px rgba(0, 0, 0, 0.5) !important;
}

.ant-card-head {
    border-bottom: 1px solid rgba(255, 255, 255, 0.2) !important;
}

.ant-card-head-title, .ant-card-extra {
    color: #fff !important;
}

.ant-card-body {
    background: transparent !important;
}

.ant-descriptions-title {
    color: #fff !important;
}

/* Ensure descriptions content and labels are visible */
.ant-descriptions-item-label, .ant-descriptions-item-content {
    color: rgba(255, 255, 255, 0.8) !important;
}

.ant-descriptions-bordered .ant-descriptions-item-label,
.ant-descriptions-bordered .ant-descriptions-item-content {
    background: transparent !important;
    border-color: rgba(255, 255, 255, 0.2) !important;
}

/* ====== QR Code Boxes (Modern & Circular) ====== */
.qr-box {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 10px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 50%;
    width: 150px;
    height: 150px;
    margin: 0 auto;
    border: 2px solid #ff00e1;
    box-shadow: 0 0 20px #ff00e1, inset 0 0 10px #ff00e1;
    transition: all 0.4s ease;
}

.qr-box:hover {
    transform: scale(1.05) rotate(5deg);
    box-shadow: 0 0 30px #00ffe7, inset 0 0 15px #00ffe7;
    border-color: #00ffe7;
}

.qr-box .qr-tag {
    position: absolute;
    top: -15px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(90deg, #ff00e1, #00ffe7) !important;
    color: #fff !important;
    border: none !important;
    box-shadow: 0 0 10px #ff00e1;
    font-weight: 600;
    z-index: 10;
    padding: 4px 10px;
    border-radius: 15px;
}

.qr-cv {
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.3s ease;
}

/* ====== Gradient Buttons ====== */
.ant-btn-primary {
    background: linear-gradient(90deg, #00ffe7, #ff00e1) !important;
    border: none !important;
    color: #1a1a2e !important;
    font-weight: 600;
    border-radius: 10px !important;
    box-shadow: 0 5px 20px rgba(0, 255, 200, 0.2), 0 5px 20px rgba(255, 0, 255, 0.2);
    transition: all 0.3s ease;
}

.ant-btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(0, 255, 200, 0.4), 0 8px 30px rgba(255, 0, 255, 0.4);
}

.ant-dropdown-link {
    color: #fff !important;
}

.ant-dropdown-menu {
    background: rgba(255, 255, 255, 0.1) !important;
    backdrop-filter: blur(10px) !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
}

.ant-dropdown-menu-item {
    color: #fff !important;
    transition: background-color 0.2s;
}

.ant-dropdown-menu-item:hover {
    background-color: rgba(255, 255, 255, 0.1) !important;
    color: #00ffe7 !important;
}

/* ====== Adjustments for layout and spacing ====== */
.qr-row {
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
}

.qr-col {
    display: flex;
    justify-content: center;
    margin-bottom: 30px;
}

.ant-list-bordered {
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
    background: transparent !important;
}

.ant-list-item {
    border-bottom: 1px solid rgba(255, 255, 255, 0.2) !important;
}

</style>
{{ template "page/head_end" .}}

{{ template "page/body_start" .}}
<div class="background-animated"></div>
<a-layout id="app" v-cloak :class="themeSwitcher.currentTheme">
    <a-layout-content class="p-2">
        <a-row type="flex" justify="center" class="mt-2">
            <a-col :xs="24" :sm="22" :md="18" :lg="14" :xl="12">
                <a-card hoverable class="subscription-card">
                    <template #title>
                        <a-space>
                            <span>{{ i18n "subscription.title" }}</span>
                            <a-tag>{{ .sId }}</a-tag>
                        </a-space>
                    </template>
                    <template #extra>
                        <a-popover
                            :overlay-class-name="themeSwitcher.currentTheme"
                            title='{{ i18n "menu.settings" }}'
                            placement="bottomRight" trigger="click">
                            <template #content>
                                <a-space direction="vertical" :size="10">
                                    <a-theme-switch-login></a-theme-switch-login>
                                    <span>{{ i18n "pages.settings.language" }}</span>
                                    <a-select ref="selectLang" class="w-100"
                                              v-model="lang"
                                              @change="LanguageManager.setLanguage(lang)"
                                              :dropdown-class-name="themeSwitcher.currentTheme">
                                        <a-select-option :value="l.value"
                                                         label="English"
                                                         v-for="l in LanguageManager.supportedLanguages"
                                                         :key="l.value">
                                            <span role="img"
                                                  :aria-label="l.name"
                                                  v-text="l.icon"></span>
                                            &nbsp;&nbsp;<span
                                                  v-text="l.name"></span>
                                        </a-select-option>
                                    </a-select>
                                </a-space>
                            </template>
                            <a-button shape="circle" icon="setting"></a-button>
                        </a-popover>
                    </template>

                    <a-form layout="vertical">
                        <a-form-item>
                            <a-space direction="vertical" align="center" style="width:100%;">
                                <a-row type="flex" :gutter="[8,8]"
                                       justify="center" class="qr-row">
                                    <a-col :xs="24" :sm="12" class="qr-col">
                                        <tr-qr-box class="qr-box">
                                            <a-tag color="purple" class="qr-tag">
                                                <span>{{ i18n "pages.settings.subSettings"}}</span>
                                            </a-tag>
                                            <tr-qr-bg class="qr-bg-sub">
                                                <tr-qr-bg-inner class="qr-bg-sub-inner">
                                                    <canvas id="qrcode"
                                                            class="qr-cv"
                                                            title='{{ i18n "copy" }}'
                                                            @click="copy(app.subUrl)"></canvas>
                                                </tr-qr-bg-inner>
                                            </tr-qr-bg>
                                        </tr-qr-box>
                                    </a-col>
                                    <a-col :xs="24" :sm="12" class="qr-col">
                                        <tr-qr-box class="qr-box">
                                            <a-tag color="purple" class="qr-tag">
                                                <span>{{ i18n "pages.settings.subSettings"}} Json</span>
                                            </a-tag>
                                            <tr-qr-bg class="qr-bg-sub">
                                                <tr-qr-bg-inner class="qr-bg-sub-inner">
                                                    <canvas id="qrcode-subjson"
                                                            class="qr-cv"
                                                            title='{{ i18n "copy" }}'
                                                            @click="copy(app.subJsonUrl)"></canvas>
                                                </tr-qr-bg-inner>
                                            </tr-qr-bg>
                                        </tr-qr-box>
                                    </a-col>
                                </a-row>
                            </a-space>
                        </a-form-item>

                        <a-form-item>
                            <a-descriptions bordered :column="1" size="small">
                                <a-descriptions-item
                                    label='{{ i18n "subscription.subId" }}'>[[
                                    app.sId
                                    ]]</a-descriptions-item>
                                <a-descriptions-item
                                    label='{{ i18n "subscription.status" }}'>
                                    <template v-if="isUnlimited">
                                        <a-tag color="purple">{{ i18n
                                            "subscription.unlimited" }}</a-tag>
                                    </template>
                                    <template v-else>
                                        <a-tag
                                            :color="isActive ? 'green' : 'red'">[[
                                            isActive ? '{{ i18n
                                            "subscription.active" }}' : '{{ i18n
                                            "subscription.inactive" }}'
                                            ]]</a-tag>
                                    </template>
                                </a-descriptions-item>
                                <a-descriptions-item
                                    label='{{ i18n "subscription.downloaded" }}'>[[
                                    app.download
                                    ]]</a-descriptions-item>
                                <a-descriptions-item
                                    label='{{ i18n "subscription.uploaded" }}'>[[
                                    app.upload
                                    ]]</a-descriptions-item>
                                <a-descriptions-item
                                    label='{{ i18n "usage" }}'>[[ app.used
                                    ]]</a-descriptions-item>
                                <a-descriptions-item
                                    label='{{ i18n "subscription.totalQuota" }}'>[[
                                    app.total
                                    ]]</a-descriptions-item>
                                <a-descriptions-item v-if="app.totalByte > 0"
                                    label='{{ i18n "remained" }}'>[[
                                    app.remained ]]</a-descriptions-item>
                                <a-descriptions-item
                                    label='{{ i18n "lastOnline" }}'>
                                    <template v-if="app.lastOnlineMs > 0">
                                        <template
                                            v-if="app.datepicker === 'gregorian'">
                                            [[
                                            DateUtil.formatMillis(app.lastOnlineMs)
                                            ]]
                                        </template>
                                        <template v-else>
                                            [[
                                            DateUtil.convertToJalalian(moment(app.lastOnlineMs))
                                            ]]
                                        </template>
                                    </template>
                                    <template v-else>
                                        <span>-</span>
                                    </template>
                                </a-descriptions-item>
                                <a-descriptions-item
                                    label='{{ i18n "subscription.expiry" }}'>
                                    <template v-if="app.expireMs === 0">
                                        {{ i18n "subscription.noExpiry" }}
                                    </template>
                                    <template v-else>
                                        <template
                                            v-if="app.datepicker === 'gregorian'">
                                            [[
                                            DateUtil.formatMillis(app.expireMs)
                                            ]]
                                        </template>
                                        <template v-else>
                                            [[
                                            DateUtil.convertToJalalian(moment(app.expireMs))
                                            ]]
                                        </template>
                                    </template>
                                </a-descriptions-item>
                            </a-descriptions>
                        </a-form-item>

                        <br />
                        <a-list bordered>
                            <a-list-item v-for="(link, idx) in links" :key="link">
                                <div style="width:100%; text-align:center;">
                                    <a-button type="primary" :block="isMobile"
                                        @click="copy(link)">[[ linkName(link, idx)
                                        ]]</a-button>
                                </div>
                            </a-list-item>
                        </a-list>
                        <br />

                        <a-form-item>
                            <a-row type="flex" justify="center" :gutter="[8,8]"
                                style="width:100%">
                                <a-col :xs="24" :sm="12"
                                    style="text-align:center;">
                                    <a-dropdown :trigger="['click']">
                                        <a-button :block="isMobile"
                                            :style="{ marginTop: isMobile ? '6px' : 0 }"
                                            size="large" type="primary">
                                            Android <a-icon type="down" />
                                        </a-button>
                                        <a-menu slot="overlay"
                                            :class="themeSwitcher.currentTheme">
                                            <a-menu-item key="android-v2box"
                                                @click="open('v2box://install-sub?url=' + encodeURIComponent(app.subUrl) + '&name=' + encodeURIComponent(app.sId))">V2Box</a-menu-item>
                                            <a-menu-item key="android-v2rayng"
                                                @click="open('v2rayng://install-config?url=' + encodeURIComponent(app.subUrl))">V2RayNG</a-menu-item>
                                            <a-menu-item key="android-singbox"
                                                @click="copy(app.subUrl)">Sing-box</a-menu-item>
                                            <a-menu-item key="android-v2raytun"
                                                @click="copy(app.subUrl)">V2RayTun</a-menu-item>
                                            <a-menu-item key="android-npvtunnel"
                                                @click="copy(app.subUrl)">NPV
                                                Tunnel</a-menu-item>
                                        </a-menu>
                                    </a-dropdown>
                                </a-col>
                                <a-col :xs="24" :sm="12"
                                    style="text-align:center;">
                                    <a-dropdown :trigger="['click']">
                                        <a-button :block="isMobile"
                                            :style="{ marginTop: isMobile ? '6px' : 0 }"
                                            size="large" type="primary">
                                            iOS <a-icon type="down" />
                                        </a-button>
                                        <a-menu slot="overlay"
                                            :class="themeSwitcher.currentTheme">
                                            <a-menu-item key="ios-shadowrocket"
                                                @click="open('shadowrocket://add/subscription?url=' + encodeURIComponent(app.subUrl) + '&remark=' + encodeURIComponent(app.sId))">Shadowrocket</a-menu-item>
                                            <a-menu-item key="ios-v2box"
                                                @click="open('v2box://install-sub?url=' + encodeURIComponent(app.subUrl) + '&name=' + encodeURIComponent(app.sId))">V2Box</a-menu-item>
                                            <a-menu-item key="ios-streisand"
                                                @click="open('streisand://import/' + encodeURIComponent(app.subUrl))">Streisand</a-menu-item>
                                            <a-menu-item key="ios-v2raytun"
                                                @click="copy(app.subUrl)">V2RayTun</a-menu-item>
                                            <a-menu-item key="ios-npvtunnel"
                                                @click="copy(app.subUrl)">NPV
                                                Tunnel</a-menu-item>
                                        </a-menu>
                                    </a-dropdown>
                                </a-col>
                            </a-row>
                        </a-form-item>
                    </a-form>
                </a-card>
            </a-col>
        </a-row>
    </a-layout-content>
</a-layout>

<template id="subscription-data" data-sid="{{ .sId }}"
    data-sub-url="{{ .subUrl }}" data-subjson-url="{{ .subJsonUrl }}"
    data-download="{{ .download }}"
    data-upload="{{ .upload }}" data-used="{{ .used }}"
    data-total="{{ .total }}" data-remained="{{ .remained }}"
    data-expire="{{ .expire }}" data-lastonline="{{ .lastOnline }}"
    data-downloadbyte="{{ .downloadByte }}"
    data-uploadbyte="{{ .uploadByte }}" data-totalbyte="{{ .totalByte }}"
    data-datepicker="{{ .datepicker }}"></template>
<textarea id="subscription-links"
    style="display:none">{{ range .result }}{{ . }}
{{ end }}</textarea>

{{template "component/aThemeSwitch" .}}
<script src="{{ .base_path }}assets/js/subscription.js?{{ .cur_ver }}"></script>

{{ template "page/body_end" .}}