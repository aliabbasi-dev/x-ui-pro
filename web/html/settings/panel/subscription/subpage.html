{{ template "page/head_start" .}}
<script src="{{ .base_path }}assets/moment/moment.min.js"></script>
<script src="{{ .base_path }}assets/moment/moment-jalali.min.js?{{ .cur_ver }}"></script>
<script src="{{ .base_path }}assets/vue/vue.min.js?{{ .cur_ver }}"></script>
<script src="{{ .base_path }}assets/ant-design-vue/antd.min.js"></script>
<script src="{{ .base_path }}assets/js/util/index.js?{{ .cur_ver }}"></script>
<script src="{{ .base_path }}assets/js/util/date-util.js?{{ .cur_ver }}"></script>
<script src="{{ .base_path }}assets/qrcode/qrious2.min.js?{{ .cur_ver }}"></script>

<style>
    /* ------------------------------------------- */
    /* Root Variables for Themes (Neumorphism Focused) */
    /* ------------------------------------------- */
    :root, #app.light {
        --base-color: #e0e5ec;
        --main-bg-gradient: linear-gradient(145deg, #e7ecef, #c3ccd4);
        --card-bg: var(--base-color);
        --text-color: #34495e;
        --secondary-text-color: #7f8c8d;
        --border-color: #d1d9e6;
        --highlight-color: #f0f5fa; /* Lighter shade for neumorphic effect */
        --shadow-light: #ffffff;
        --shadow-dark: #a3b1c6;
        --primary-button-bg: #3498db;
        --primary-button-hover-bg: #2980b9;
        --tag-color: #8e44ad;
    }
    #app.dark {
        --base-color: #2e3a45;
        --main-bg-gradient: linear-gradient(145deg, #323d46, #2a353d);
        --card-bg: var(--base-color);
        --text-color: #ecf0f1;
        --secondary-text-color: #bdc3c7;
        --border-color: #3f4a4d;
        --highlight-color: #3d4a53; /* Lighter shade for neumorphic effect */
        --shadow-light: #3d4a53;
        --shadow-dark: #1f272c;
        --primary-button-bg: #4a69bd;
        --primary-button-hover-bg: #34495e;
        --tag-color: #9b59b6;
    }
    #app.ultra-dark {
        --base-color: #1a1a1a;
        --main-bg-gradient: linear-gradient(145deg, #1f1f1f, #151515);
        --card-bg: var(--base-color);
        --text-color: #f0f0f0;
        --secondary-text-color: #b0b0b0;
        --border-color: #2a2a2a;
        --highlight-color: #2b2b2b; /* Lighter shade for neumorphic effect */
        --shadow-light: #2a2a2a;
        --shadow-dark: #0a0a0a;
        --primary-button-bg: #6c5ce7;
        --primary-button-hover-bg: #4c40b2;
        --tag-color: #be2edd;
    }

    /* ------------------------------------------- */
    /* Neumorphism Mixin (for reusable shadows) */
    /* ------------------------------------------- */
    .neumorphic-shadow-concave {
        box-shadow: 
            7px 7px 15px var(--shadow-dark), 
            -7px -7px 15px var(--shadow-light);
    }
    .neumorphic-shadow-convex {
        box-shadow: 
            inset 5px 5px 10px var(--shadow-dark), 
            inset -5px -5px 10px var(--shadow-light);
    }
    .neumorphic-button-shadow {
        box-shadow: 
            5px 5px 10px var(--shadow-dark), 
            -5px -5px 10px var(--shadow-light);
    }
    .neumorphic-button-pressed {
        box-shadow: 
            inset 3px 3px 7px var(--shadow-dark), 
            inset -3px -3px 7px var(--shadow-light);
    }

    /* ------------------------------------------- */
    /* General Styles */
    /* ------------------------------------------- */
    body {
        font-family: 'Poppins', 'Vazirmatn', sans-serif;
    }
    #app.subscription-page {
        background: var(--main-bg-gradient);
        transition: all 0.5s ease-in-out;
    }
    
    /* Card Styles */
    .subscription-card {
        border-radius: 25px;
        background-color: var(--card-bg);
        color: var(--text-color);
        border: none;
        padding: 20px; /* Adjust padding for better neumorphic spacing */
        .neumorphic-shadow-concave; /* Apply convex shadow by default */
        transition: all 0.5s ease-in-out;
    }
    .subscription-card .ant-card-head {
        border-bottom: none; /* No border for neumorphic look */
        padding-bottom: 10px;
    }
    .ant-card-head-title, .ant-descriptions-item-label {
        color: var(--text-color);
        font-weight: 600;
    }
    .ant-descriptions-item-content {
        color: var(--secondary-text-color);
    }
    .ant-popover-inner-content, .ant-dropdown-menu {
        background-color: var(--card-bg);
        border-radius: 15px;
        .neumorphic-shadow-concave;
    }
    .ant-dropdown-menu-item, .ant-dropdown-menu-item a {
        color: var(--text-color) !important;
        transition: background-color 0.2s;
    }
    .ant-dropdown-menu-item:hover {
        background-color: var(--highlight-color);
    }
    .ant-btn-circle {
        background-color: var(--card-bg);
        border: none;
        color: var(--secondary-text-color);
        border-radius: 50%;
        .neumorphic-button-shadow;
        transition: all 0.2s ease-in-out;
    }
    .ant-btn-circle:hover {
        .neumorphic-button-pressed;
        color: var(--primary-button-bg);
    }

    /* Descriptions List (Info Table) */
    .ant-descriptions-bordered {
        border-radius: 20px;
        overflow: hidden;
        border: none;
        background-color: var(--card-bg);
        .neumorphic-shadow-convex; /* Inner shadow for description list */
    }
    .ant-descriptions-bordered .ant-descriptions-item-label {
        background-color: var(--highlight-color);
        font-weight: 500;
        color: var(--secondary-text-color);
        border-bottom: 1px solid var(--border-color);
        border-right: 1px solid var(--border-color); /* For columns */
    }
    .ant-descriptions-bordered .ant-descriptions-item-content {
        background-color: var(--card-bg);
        color: var(--text-color);
        border-bottom: 1px solid var(--border-color);
    }
    .ant-descriptions-bordered .ant-descriptions-item {
        border-right: none !important; /* Remove default Ant Design borders */
        border-bottom: none !important;
    }
    
    /* Buttons and Tags */
    .ant-btn-primary {
        border-radius: 15px;
        font-weight: 600;
        background-color: var(--primary-button-bg);
        border: none;
        color: white; /* Ensure text is white for primary buttons */
        .neumorphic-button-shadow;
        transition: all 0.2s ease-in-out;
    }
    .ant-btn-primary:hover {
        background-color: var(--primary-button-hover-bg);
        .neumorphic-button-pressed;
    }
    .ant-tag {
        border-radius: 10px;
        font-size: 14px;
        padding: 5px 12px;
        background-color: var(--tag-color); /* A specific accent color for tags */
        color: white;
        border: none;
        box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
    }

    /* ------------------------------------------- */
    /* QR Code Section - Neumorphic */
    /* ------------------------------------------- */
    .qr-box {
        position: relative;
        background-color: var(--card-bg);
        border-radius: 25px;
        padding: 30px;
        .neumorphic-shadow-concave; /* Convex shadow for the outer QR box */
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 20px;
    }
    .qr-tag {
        position: absolute;
        top: 20px;
        right: 20px;
        border-radius: 10px;
        font-size: 14px;
        padding: 5px 12px;
        background-color: var(--tag-color);
        color: white;
        border: none;
        box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
    }
    .qr-bg-sub-inner {
        border-radius: 20px;
        padding: 20px;
        background-color: var(--card-bg);
        .neumorphic-shadow-convex; /* Concave shadow for the inner QR area */
        display: flex;
        justify-content: center;
        align-items: center;
    }
    #qrcode, #qrcode-subjson {
        border-radius: 15px;
        background-color: white; /* QR codes usually need a white background */
    }
    #app.dark #qrcode, #app.dark #qrcode-subjson,
    #app.ultra-dark #qrcode, #app.ultra-dark #qrcode-subjson {
        background-color: #fff; /* Ensure QR code is readable */
    }

    /* ------------------------------------------- */
    /* List Item */
    /* ------------------------------------------- */
    .ant-list {
        border-radius: 20px;
        overflow: hidden;
        border: none;
        background-color: var(--card-bg);
        .neumorphic-shadow-concave;
    }
    .ant-list-item {
        transition: all 0.3s;
        background-color: var(--card-bg);
        border-bottom: 1px solid var(--border-color);
        color: var(--text-color);
    }
    .ant-list-item:last-child {
        border-bottom: none;
    }
    .ant-list-item:hover {
        background-color: var(--highlight-color);
    }

    /* Responsive Adjustments */
    @media (max-width: 576px) {
        .subscription-card {
            padding: 15px;
            border-radius: 18px;
        }
        .qr-box {
            padding: 15px;
            border-radius: 18px;
        }
        .qr-bg-sub-inner {
            padding: 10px;
            border-radius: 15px;
        }
        .ant-tag {
            font-size: 12px;
            padding: 3px 8px;
        }
        .ant-btn-primary {
            border-radius: 10px;
        }
    }

</style>

{{ template "page/head_end" .}}

{{ template "page/body_start" .}}
<a-layout id="app" v-cloak :class="themeSwitcher.currentTheme + ' subscription-page'">
    <a-layout-content class="p-2">
        <a-row type="flex" justify="center" class="mt-4">
            <a-col :xs="24" :sm="22" :md="18" :lg="14" :xl="12">
                <a-card hoverable class="subscription-card">
                    <template #title>
                        <a-space>
                            <span>{{ i18n "subscription.title" }}</span>
                            <a-tag>{{ .sId }}</a-tag>
                        </a-space>
                    </template>
                    <template #extra>
                        <a-popover
                            :overlay-class-name="themeSwitcher.currentTheme"
                            title='{{ i18n "menu.settings" }}'
                            placement="bottomRight" trigger="click">
                            <template #content>
                                <a-space direction="vertical" :size="10">
                                    <a-theme-switch-login></a-theme-switch-login>
                                    <span>{{ i18n "pages.settings.language"
                                        }}</span>
                                    <a-select ref="selectLang" class="w-100"
                                        v-model="lang"
                                        @change="LanguageManager.setLanguage(lang)"
                                        :dropdown-class-name="themeSwitcher.currentTheme">
                                        <a-select-option :value="l.value"
                                            label="English"
                                            v-for="l in LanguageManager.supportedLanguages"
                                            :key="l.value">
                                            <span role="img"
                                                :aria-label="l.name"
                                                v-text="l.icon"></span>
                                            &nbsp;&nbsp;<span
                                                v-text="l.name"></span>
                                        </a-select-option>
                                    </a-select>
                                </a-space>
                            </template>
                            <a-button shape="circle" icon="setting"></a-button>
                        </a-popover>
                    </template>

                    <a-form layout="vertical">
                        <a-form-item>
                            <a-space direction="vertical" align="center">
                                <a-row type="flex" :gutter="[24,24]"
                                    justify="center" style="width:100%">
                                    <a-col :xs="24" :sm="app.subJsonUrl ? 12 : 24"
                                        style="text-align:center;">
                                        <tr-qr-box class="qr-box">
                                            <a-tag color="purple"
                                                class="qr-tag">
                                                <span>{{ i18n
                                                    "pages.settings.subSettings"}}</span>
                                            </a-tag>
                                            <tr-qr-bg class="qr-bg-sub">
                                                <tr-qr-bg-inner
                                                    class="qr-bg-sub-inner">
                                                    <canvas id="qrcode"
                                                        class="qr-cv"
                                                        title='{{ i18n "copy" }}'
                                                        @click="copy(app.subUrl)"></canvas>
                                                </tr-qr-bg-inner>
                                            </tr-qr-bg>
                                        </tr-qr-box>
                                    </a-col>
                                    <a-col v-if="app.subJsonUrl" :xs="24" :sm="12"
                                        style="text-align:center;">
                                        <tr-qr-box class="qr-box">
                                            <a-tag color="purple"
                                                class="qr-tag">
                                                <span>{{ i18n
                                                    "pages.settings.subSettings"}}
                                                    Json</span>
                                            </a-tag>
                                            <tr-qr-bg class="qr-bg-sub">
                                                <tr-qr-bg-inner
                                                    class="qr-bg-sub-inner">
                                                    <canvas id="qrcode-subjson"
                                                        class="qr-cv"
                                                        title='{{ i18n "copy" }}'
                                                        @click="copy(app.subJsonUrl)"></canvas>
                                                </tr-qr-bg-inner>
                                            </tr-qr-bg>
                                        </tr-qr-box>
                                    </a-col>
                                </a-row>
                            </a-space>
                        </a-form-item>

                        <a-form-item>
                            <a-descriptions bordered :column="1" size="small">
                                <a-descriptions-item
                                    label='{{ i18n "subscription.subId" }}'>[[
                                    app.sId
                                    ]]</a-descriptions-item>
                                <a-descriptions-item
                                    label='{{ i18n "subscription.status" }}'>
                                    <template v-if="isUnlimited">
                                        <a-tag color="purple">{{ i18n
                                            "subscription.unlimited" }}</a-tag>
                                    </template>
                                    <template v-else>
                                        <a-tag
                                            :color="isActive ? 'green' : 'red'">[[
                                            isActive ? '{{ i18n
                                            "subscription.active" }}' : '{{ i18n
                                            "subscription.inactive" }}'
                                            ]]</a-tag>
                                    </template>
                                </a-descriptions-item>
                                <a-descriptions-item
                                    label='{{ i18n "subscription.downloaded" }}'>[[
                                    app.download
                                    ]]</a-descriptions-item>
                                <a-descriptions-item
                                    label='{{ i18n "subscription.uploaded" }}'>[[
                                    app.upload
                                    ]]</a-descriptions-item>
                                <a-descriptions-item
                                    label='{{ i18n "usage" }}'>[[ app.used
                                    ]]</a-descriptions-item>
                                <a-descriptions-item
                                    label='{{ i18n "subscription.totalQuota" }}'>[[
                                    app.total
                                    ]]</a-descriptions-item>
                                <a-descriptions-item v-if="app.totalByte > 0"
                                    label='{{ i18n "remained" }}'>[[
                                    app.remained ]]</a-descriptions-item>
                                <a-descriptions-item
                                    label='{{ i18n "lastOnline" }}'>
                                    <template v-if="app.lastOnlineMs > 0">
                                        <template
                                            v-if="app.datepicker === 'gregorian'">
                                            [[
                                            DateUtil.formatMillis(app.lastOnlineMs)
                                            ]]
                                        </template>
                                        <template v-else>
                                            [[
                                            DateUtil.convertToJalalian(moment(app.lastOnlineMs))
                                            ]]
                                        </template>
                                    </template>
                                    <template v-else>
                                        <span>-</span>
                                    </template>
                                </a-descriptions-item>
                                <a-descriptions-item
                                    label='{{ i18n "subscription.expiry" }}'>
                                    <template v-if="app.expireMs === 0">
                                        {{ i18n "subscription.noExpiry" }}
                                    </template>
                                    <template v-else>
                                        <template
                                            v-if="app.datepicker === 'gregorian'">
                                            [[
                                            DateUtil.formatMillis(app.expireMs)
                                            ]]
                                        </template>
                                        <template v-else>
                                            [[
                                            DateUtil.convertToJalalian(moment(app.expireMs))
                                            ]]
                                        </template>
                                    </template>
                                </a-descriptions-item>
                            </a-descriptions>
                        </a-form-item>
                    </a-form>

                    <br />
                    <a-list bordered>
                        <a-list-item v-for="(link, idx) in links" :key="link">
                            <div style="width:100%; text-align:center;">
                                <a-button type="primary" :block="isMobile"
                                    @click="copy(link)">[[ linkName(link, idx)
                                    ]]</a-button>
                            </div>
                        </a-list-item>
                    </a-list>
                    <br />

                    <a-form layout="vertical">
                        <a-form-item>
                            <a-row type="flex" justify="center" :gutter="[8,8]"
                                style="width:100%">
                                <a-col :xs="24" :sm="12"
                                    style="text-align:center;">
                                    <a-dropdown :trigger="['click']">
                                        <a-button icon="android" :block="isMobile"
                                            :style="{ marginTop: isMobile ? '6px' : 0 }"
                                            size="large" type="primary">
                                            Android <a-icon type="down" />
                                        </a-button>
                                        <a-menu slot="overlay"
                                            :class="themeSwitcher.currentTheme">
                                            <a-menu-item key="android-v2box"
                                                @click="open('v2box://install-sub?url=' + encodeURIComponent(app.subUrl) + '&name=' + encodeURIComponent(app.sId))">V2Box</a-menu-item>
                                            <a-menu-item key="android-v2rayng"
                                                @click="open('v2rayng://install-config?url=' + encodeURIComponent(app.subUrl))">V2RayNG</a-menu-item>
                                            <a-menu-item key="android-singbox"
                                                @click="copy(app.subUrl)">Sing-box</a-menu-item>
                                            <a-menu-item key="android-v2raytun"
                                                @click="copy(app.subUrl)">V2RayTun</a-menu-item>
                                            <a-menu-item key="android-npvtunnel"
                                                @click="copy(app.subUrl)">NPV
                                                Tunnel</a-menu-item>
                                        </a-menu>
                                    </a-dropdown>
                                </a-col>
                                <a-col :xs="24" :sm="12"
                                    style="text-align:center;">
                                    <a-dropdown :trigger="['click']">
                                        <a-button icon="apple" :block="isMobile"
                                            :style="{ marginTop: isMobile ? '6px' : 0 }"
                                            size="large" type="primary">
                                            iOS <a-icon type="down" />
                                        </a-button>
                                        <a-menu slot="overlay"
                                            :class="themeSwitcher.currentTheme">
                                            <a-menu-item key="ios-shadowrocket"
                                                @click="open(shadowrocketUrl)">Shadowrocket</a-menu-item>
                                            <a-menu-item key="ios-v2box"
                                                @click="open(v2boxUrl)">V2Box</a-menu-item>
                                            <a-menu-item key="ios-streisand"
                                                @click="open(streisandUrl)">Streisand</a-menu-item>
                                            <a-menu-item key="ios-v2raytun"
                                                @click="copy(v2raytunUrl)">V2RayTun</a-menu-item>
                                            <a-menu-item key="ios-npvtunnel"
                                                @click="copy(npvtunUrl)">NPV
                                                Tunnel
                                            </a-menu-item>
                                        </a-menu>
                                    </a-dropdown>
                                </a-col>
                            </a-row>
                        </a-form-item>
                    </a-form>
                </a-card>
            </a-col>
        </a-row>
    </a-layout-content>
</a-layout>

<template id="subscription-data" data-sid="{{ .sId }}"
    data-sub-url="{{ .subUrl }}" data-subjson-url="{{ .subJsonUrl }}"
    data-download="{{ .download }}"
    data-upload="{{ .upload }}" data-used="{{ .used }}"
    data-total="{{ .total }}" data-remained="{{ .remained }}"
    data-expire="{{ .expire }}" data-lastonline="{{ .lastOnline }}"
    data-downloadbyte="{{ .downloadByte }}"
    data-uploadbyte="{{ .uploadByte }}" data-totalbyte="{{ .totalByte }}"
    data-datepicker="{{ .datepicker }}"></template>
<textarea id="subscription-links"
    style="display:none">{{ range .result }}{{ . }}
{{ end }}</textarea>

{{template "component/aThemeSwitch" .}}
<script src="{{ .base_path }}assets/js/subscription.js?{{ .cur_ver }}"></script>

{{ template "page/body_end" .}}